---
title: PFC简介
author: lijiabao
date: 2021-04-14 20:30
categories: ["PFC笔记", "数值模拟"]
tags: ["PFC笔记", "数值模拟"]
---

主要解药介绍以下PFC（Particle flow code）颗粒流方法，以及PFC中的一些重要术语和概念

## PFC简介

>  PFC（颗粒流方法）：基于通用离散元模型（DEM）框架，由计算引擎和图形用户界面构成的细观分析软件。

PFC主要用于模拟有限尺寸颗粒的运动和相互作用，而颗粒是带质量的刚形体，可以平移和转动。颗粒内部通过内部惯性力、力矩，以成对接触力方式产生相互作用，接触力通过更新内力、力矩产生相互作用.

### PFC模型基本组成

>  PFC模型中的每一个颗粒被表示为实体，它不是一个点质量，而是一个带有有限质量和定义了表面的刚形体。

PFC模型主要由三部分组成：

- 实体（body），有三种类型：每个实体由一个片或者多个片组成，球只有一个片。<font color='red'>所有的实体都只能出现在domain区域，不能超出这个区域</font>
  1. 球（ball）：只有一个片。球在三维里表现为球体，二维里表现为单位厚度的圆盘
  2. 簇（clump）：簇的片叫做pebble，簇是pebble的集合。三维里是许多球体，二维里是许多单位厚度的圆盘。组成簇的pebble可以相互重叠，簇的实体内部没有接触，但是接触可以在不同实体间的片产生
  3. 墙（wall）：墙的片叫做facet，墙是facet（面）的集合。facets在二维表现为线段，三维表现为三角形，由facet可以构成任意复杂的空间多边形。
- 片（piece）：pebble和facet
- 接触（contact）：颗粒的相互接触接触相互作用定律，通过软接触方法实现的。所有的变形都只能产生于刚性实体接触

球和簇的运动遵守牛顿运动定律，但是墙的运动是用户指定的。因此只有球和簇有质量特性（质量、中心位置和惯性张量）和加载条件（接触的力和力矩，重力，外部作用力和力矩）

### PFC的常用术语

熟悉并且区分以下术语，可以更快的了解PFC方法：

1. domain（范围）
   domain表示的是一个区域，用来进行接触检测判断。PFC5.0中，所有的对象都在给定的domain区域中。
   domain的四种边界条件类型：

   1. stop：当颗粒、wall、clump等碰到边界之后，停止运动
   2. destroy：碰到边界直接删除
   3. reflect：碰到边界速度方向，往回弹
   4. periodic：从domain相对面（另一面）重新出现，用于均匀化方法。按照维度设置x，y，z三个方向的范围，只设置一个的话，其他的默认和设置的一样。

2. bodies（实体）和pieces（片）
   PFC实体有三种（ball，wall，clump），每个实体由一个或者多个piece构成，piece是用来进行接触检测判断的。每个body上所有的piece的计算数据都存储于该body上，用来进行系统运动方程的积分求解。

   **piece接触类型**：ball-ball、ball-facet、ball-pebble、pebble-pebble、pebble-facet
   接触类型顺序依次是：ball、pebble、facet

3. wall和facet
   wall是一系列的facet构成，每个facet具有2个或者3个端点，这些端点统称为wall的顶点（vertex），使用wall.vertex.list遍历查询，flac3D 6.0和PFC3D 5.0之间的耦合也是基于这个进行的

4. clump和pebble
   构成刚性簇的球称之为pebble，接触类型中的pebble-pebble指的是不同刚性簇之间的接触，不包括同一簇内部球体之间的接触

5. cluster和clump
   cluster指一组ball通过特定的设置利用接触相互黏结、密实，表现出簇的特性，但是之间的接触有限，在外力足够下颗粒又可破碎，称之为柔性簇
   clump指一系列球叠加在一起，无论什么条件，各pebble之间无相对变形，从而呈现出刚性颗粒运动的簇，称之为刚性簇。

6. DFN和fracture
   DFN（discrete fracture network）离散裂隙网络，fracture指的是单一裂隙，DFN是fracture的集合

7. damping
   阻尼（damping）是用来消耗系统内部能量。可以通过三种方式消耗内部能量：

   1. 摩擦
   2. 接触中的黏壶（dashpot）部分
   3. 在运动方程中设置局部阻尼（local damping）：静态求解，设置较大的局部阻尼，加快计算平衡，动力求解时，需要设置合理的局部阻尼。设置阻尼：ball attribute和clump attribute加关键字damp设置局部阻尼大小`ball attribute damp 0.7`类似的命令。PFC4.0默认0.7局部阻尼，PFC5.0默认设置为0
   
8. 属性（attribute）和接触特性（property）
   attributies是模型实体的内在特性，如：位置、速度和大小等。实体、片和接触都有attribute。
   properties仅仅应用到到piece（片）上，是用户指定的字符串和值的列表，这些字符串和值代表了piece的表面条件，properties可以决定piece之间如何相互作用，接触模型可以使用piece properties来决定结果的相互作用。properties通常用于属性继承，作为<font color='red'>接触参数设置的方法之一</font>

9. 时间步（timestep）
   采用的是自动时间步测定算法来评估时间步，确保运动方程的稳定求解。PFC5.0中是基于片（piece）速度进行
   PFC固定时间步（使用`set timestep fix`），根据固定时间步和指定最大时间步值（使用`set timestep maximum`命令）

10. 接触模型分配表（CMAT）
    PFC5.2中不假定接触服从线性接触行为，默认插入一个null接触模型，直到指定其接触模型。PFC5.0中有一个接触模型分配表（CMAT），和domain一样，每个数据文件将会以`cmat default `命令开始指定默认的力学行为，对于复杂模型创建更方便。

### PFC命令流编制顺序

对于PFC命令流编制，需要按照一定的顺序，分别实现不同的功能才能进行最终的计算：接触的定义必须在球和墙生成之后，domain的定义必须在球和墙生成之前

**<font color='red'>下面介绍一个简单的命令流编制的实例：</font>**

1. <font color='red'>释放当前内存</font>，开始新的任务分析：`new`这一步是进行计算必须的步骤
2. 设置日志文件，可设置可不设置。日志主要是为了代码出错时更好的找出问题
   `set logfile filename.log`设置日志文件保存位置和文件名
   `set log on append开启日志记录，两种：append（在已有文件中续写），truncate（覆盖原有文件内容）
3. 设置模型名称，用于图像显示所用，实际计算并无影响
   `title ‘a example'`
4. <font color='red'>设置计算区域</font>（必要条件，创建ball和wall等实体前的步骤）
   `domain extent -100 100 condition periodic`
5. 设置随机种子（不指定，种子随机，每次生成的模型可能都不一样，试样不重复）
   `set random 10005`用来保证计算过程中随机数相同，保证结果重复
6. <font color='red'>生成模型的边界wall</font>（必要条件）也可以使用一组ball来作为边界
   `wall generate box -50.0 50.0`生成一个矩形wall
7. <font color='red'>创建颗粒体系</font>（ball、clump、cluster等）并分组用来对后面的属性赋值
   `ball generate radius 1.2 1.5 box -5.0 5.0 number 500`
   `ball group small_balls range radius 1.2 1.35`
   `ball group big_balls range radius 1.35 1.4`
8. <font color='red'>设定球的实体属性</font>（必要条件）如：密度、速度和阻尼等
   `ball attribute density 100.0` 设置密度
   `ball fix zvelocity range group big_balls` 固定某些颗粒流的速度，选择上面一部设置的分组来指定
   `ball attribute radius multiply 1.2`对颗粒的属性进行操作
   `ball attribute damp 0.7` 设置阻尼
9. <font color='red'>指定接触模型</font>（必要条件）可以使用contact方法、cmat方法或者属性继承方法实现
   `cmat default model linear property kn 1.0e8 fri 1.0` cmat方法实现
10. 设置球的表面属性（接触属性）
    `ball property kn 2e8 ks 1e8 fric 1.2` 属性继承
11. 添加外力（重力场和外界施加的作用力等）
    `set gravity 10.0`  设置重力
12. 设定时间步长（若不指定，取默认值）
    `set timestep auto`设置自动步长
    `set timestep 5e-3`设置指定步长
13. 记录数据（针对ball、wall、clump、measure和contact等对象）
    `wall history id 1 zcontactforce id 1`查看id为1的wall的z方向的接触应力
14. <font color='red'>计算求解</font>（必要条件）
    `; step 1000`
    `; cycle 2002`
    ` solve time 10.0 ;  solve fishhalt @stop_me`
15. 输出数据，分析
    `history write 1 file wzcforce000` 输出id为1的wall的z接触应力数据到文件wzcforce000中，默认csv后缀
16. 保存模型以及模型调用
    `save example1`保存模型为example1
    `ball attribute displacement multiply 0.0` 根据情况将唯一速度和接触力进行归零设置
    在上述的步骤完成之后，就可以改变荷载参数、物理力学变化、外部环境和力学参数变化下的系统的力学响应
    `set log off` 打开了日志文件的话需要关闭日志文件
    `return`返回操作界面

上述的步骤就是基本的PFC计算模拟所需要的一些步骤，只是不同情况、不同的模型复杂度下，模型的建立、接触定义和计算求解复杂度也不一样，但是按照上述的步骤进行编制，就可以进行计算